<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js dark">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Let's Build a Renderer</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "dark";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('dark')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="final-project-preview.html">Final Project Preview</a></li><li class="chapter-item expanded "><a href="getting-started.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="project-setup.html"><strong aria-hidden="true">1.1.</strong> Project Setup</a></li><li class="chapter-item expanded "><a href="creating-an-application.html"><strong aria-hidden="true">1.2.</strong> Creating an Application</a></li><li class="chapter-item expanded "><a href="the-logging-backend.html"><strong aria-hidden="true">1.3.</strong> The Logging Backend</a></li></ol></li><li class="chapter-item expanded "><a href="clearing-the-screen-with-vulkan.html"><strong aria-hidden="true">2.</strong> Clearing the Screen with Vulkan</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="the-vulkan-context.html"><strong aria-hidden="true">2.1.</strong> The Vulkan Context</a></li><li class="chapter-item expanded "><a href="vulkan-instances.html"><strong aria-hidden="true">2.2.</strong> Vulkan Instances</a></li><li class="chapter-item expanded "><a href="vulkan-physical-devices.html"><strong aria-hidden="true">2.3.</strong> Vulkan Physical Devices</a></li><li class="chapter-item expanded "><a href="vulkan-logical-devices.html"><strong aria-hidden="true">2.4.</strong> Vulkan Logical Devices</a></li><li class="chapter-item expanded "><a href="amd-vulkan-memory-allocator.html"><strong aria-hidden="true">2.5.</strong> The AMD Vulkan Memory Allocator</a></li></ol></li><li class="chapter-item expanded "><a href="appendix.html"><strong aria-hidden="true">3.</strong> Appendix</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-further-reading.html"><strong aria-hidden="true">3.1.</strong> A - Further Reading</a></li><li class="chapter-item expanded "><a href="appendix-keywords.html"><strong aria-hidden="true">3.2.</strong> B - Keywords</a></li><li class="chapter-item expanded "><a href="appendix-vulkan-configurator.html"><strong aria-hidden="true">3.3.</strong> C - Vulkan Configurator</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Let's Build a Renderer</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p>Welcome! This book will guide you through the creation and design of a 3D renderer using the <a href="https://www.rust-lang.org/">Rust</a> programming language and the <a href="https://www.khronos.org/vulkan/">Vulkan</a> graphics API.</p>
<h2><a class="header" href="#purpose" id="purpose">Purpose</a></h2>
<p>As of January 2021, the resources for learning Vulkan are scarce. The existing resources largely focus on <code>C++</code> and cover various rendering techniques. This is excellent! However, the focus for many of these resources is not on building a structured program that goes beyond the scope of tutorial code. This book is meant to be higher level, demonstrating how to build a 3D world and render it in realtime. This will be particularly of use to indie game developers looking to create a 3D game from scratch without getting overwhelmed.</p>
<h2><a class="header" href="#why-rust" id="why-rust">Why Rust?</a></h2>
<p>Rust is a great alternative to <code>C++</code>!  A few of the benefits:</p>
<ul>
<li>It provides a smooth workflow for developers with clear, specific error messages from the compiler</li>
<li><a href="https://rustup.rs/">rustup</a> and <a href="https://github.com/rust-lang/cargo">cargo</a> make managing rust toolchain installations and rust projects straightforward</li>
<li>The lints from <a href="https://github.com/rust-lang/rust-clippy">clippy</a> help to improve the code quality and catch certain common mistakes</li>
<li><a href="https://github.com/rust-lang/rustfmt">rustfmt</a> handles formatting the code and code style</li>
<li>Memory safety. Code written outside of <code>unsafe</code> blocks is checked by the <a href="https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html?highlight=borrow#references-and-borrowing">borrow checker</a></li>
</ul>
<h2><a class="header" href="#target-audience" id="target-audience">Target Audience</a></h2>
<p>The target audience of this book is moderately experienced developers with an interest in graphics programming. Prior graphics programming experience, particularly with <a href="https://www.opengl.org">OpenGL</a> will be particularly useful. This is the book I would have wanted to read when first starting out with Vulkan.</p>
<h2><a class="header" href="#what-is-covered" id="what-is-covered">What Is Covered</a></h2>
<p>This book is very code-heavy and implementation focused, as opposed to other resources that may be more focused on theory.</p>
<h2><a class="header" href="#what-is-not-covered" id="what-is-not-covered">What Is Not Covered</a></h2>
<p>This book will not go into detail on linear algebra concepts or mathematics, as there are already great resources available. This book may not go into as much depth on particular parts of the Vulkan API as other resources might. A list of useful external resources for building upon the content of this book can be found in the <code>Further Reading</code> section of the appendix.</p>
<h2><a class="header" href="#project-repo" id="project-repo">Project Repo</a></h2>
<p>The source code for the <code>Obsidian</code> render built in this book can be found on github:</p>
<p><a href="https://github.com/matthewjberger/obsidian">https://github.com/matthewjberger/obsidian</a></p>
<p>The source code for this mdbook can also be found on github:</p>
<p><a href="https://github.com/matthewjberger/letsbuildarenderer">https://github.com/matthewjberger/letsbuildarenderer</a></p>
<h1><a class="header" href="#final-project-preview" id="final-project-preview">Final Project Preview</a></h1>
<h2><a class="header" href="#chapter-1" id="chapter-1">Chapter 1</a></h2>
<ul>
<li>Set up the project structure</li>
<li>Get a window up and running</li>
<li>Create the boilerplate code used throughout the rest of the book</li>
</ul>
<p>The code in this chapter will serve as the project's foundation.</p>
<p><img src="images/chapter1.png" alt="file-structure" /></p>
<h1><a class="header" href="#getting-started" id="getting-started">Getting Started</a></h1>
<h2><a class="header" href="#dependencies" id="dependencies">Dependencies</a></h2>
<p>This project requires the <a href="https://www.rust-lang.org/">Rust programming language</a>.</p>
<p>The easiest way to get access to the Vulkan dependencies is to install <a href="https://vulkan.lunarg.com/sdk/home">the Vulkan SDK</a>. This provides access to the Vulkan Configurator, glslangvalidator, the debug layers, and other useful tools for working with Vulkan.</p>
<p>The latest version of <code>GCC</code> and <code>CMake</code> will also be required for ffi bindings to C/C++ libraries.</p>
<h2><a class="header" href="#development-environment-setup" id="development-environment-setup">Development Environment Setup</a></h2>
<p>Using <a href="https://code.visualstudio.com/">vscode</a> and <a href="https://github.com/rust-analyzer/rust-analyzer">rust-analyzer</a> with the rust-analyzer <a href="https://marketplace.visualstudio.com/items?itemName=matklad.rust-analyzer">vscode extension</a> is recommended. However, any Rust development environment you are comfortable with will work.</p>
<p>The <a href="https://doc.rust-lang.org/book/">official Rust book</a> is a great resource if you are new to Rust.</p>
<h3><a class="header" href="#quick-windows-setup" id="quick-windows-setup">Quick Windows Setup</a></h3>
<p>On windows, installing programs can be trickier than on other platforms. It is recommended to use a package manager such as <a href="https://scoop.sh/">Scoop</a> or <a href="https://chocolatey.org/">chocolatey</a>.</p>
<p>First, make sure <a href="https://aka.ms/wmf5download">PowerShell 5</a> (or later, include <a href="https://docs.microsoft.com/en-us/powershell/scripting/install/installing-powershell-core-on-windows?view=powershell-6">PowerShell Core</a>) and .<a href="https://www.microsoft.com/net/download">NET Framework 4.5</a> (or later) are installed. Then run:</p>
<pre><code class="language-powershell"># Install scoop
Set-ExecutionPolicy RemoteSigned -scope CurrentUser
Invoke-Expression (New-Object System.Net.WebClient).DownloadString('https://get.scoop.sh')

# Scoop uses git to update itself and 7zip to extract archives
scoop install git 7zip 

# Install the project's dependencies
scoop install gcc cmake rustup

# Set the stable rust toolchain as the default toolchain
rustup default stable

# Install vscode, kept in a separate bucket called the 'extras' bucket
scoop bucket add extras
scoop install vscode
</code></pre>
<h1><a class="header" href="#project-setup" id="project-setup">Project Setup</a></h1>
<p>The directory structure for the project will look like this:</p>
<p><img src="images/file-structure.png" alt="file-structure" /></p>
<h2><a class="header" href="#file-structure" id="file-structure">File Structure</a></h2>
<ul>
<li><code>assets/</code>
<ul>
<li><code>hdr/</code>
Contains HDR maps used for skyboxes and environment mapping</li>
<li><code>models/</code>
Contains 3D assets, such as *.gltf and *.glb files</li>
<li><code>shaders/</code>
Contains all of the shaders used in the project</li>
</ul>
</li>
<li><code>crates/</code>
<ul>
<li><code>obsidian_app/</code>
A library that handles the window and application input boilerplate</li>
</ul>
</li>
<li><code>viewer/</code>
An application that can render 3D models, developed over the course of this book</li>
</ul>
<h2><a class="header" href="#creating-the-file-structure" id="creating-the-file-structure">Creating the File Structure</a></h2>
<p>Create the project as a library:</p>
<pre><code class="language-bash">cargo new --lib obsidian
cd obsidian
</code></pre>
<p>Create the asset folders:</p>
<pre><code class="language-bash">mkdir assets
mkdir assets/hdr
mkdir assets/icon
mkdir assets/models
mkdir assets/shaders
</code></pre>
<p>Edit <code>Cargo.toml</code> to make the project a cargo workspace:</p>
<pre><code class="language-toml"># Leave the [package] section as is

[workspace]
members = [&quot;crates/*&quot;, &quot;viewer&quot;]
default-members = [&quot;viewer&quot;]

[dependencies]
obsidian_app = { path = &quot;crates/obsidian_app&quot; }
</code></pre>
<p>Create the application crate as a library:</p>
<pre><code class="language-bash">cargo new --lib crates/obsidian_app
</code></pre>
<p>Create and edit <code>crates/obsidian_app/src/app.rs</code> to add an <code>Application</code> struct. This will eventually contain everything needed for an <code>Obsidian</code> application, including a physics world, an entity component system, the renderer itself, and more.</p>
<pre><code class="language-rust noplaypen">pub struct Application;
</code></pre>
<p>Update <code>crates/obsidian_app/src/lib.rs</code>:</p>
<pre><code class="language-rust noplaypen">mod app;
pub use self::app::*;
</code></pre>
<p>Edit <code>src/lib.rs</code> to reference the app library:</p>
<pre><code class="language-rust noplaypen">pub mod app {
    pub use obsidian_app::*;
}
</code></pre>
<p>Create the viewer application:</p>
<pre><code class="language-bash">cargo new viewer
</code></pre>
<p>Update the <code>viewer/cargo.toml</code> to reference all of obsidian as a single library.</p>
<pre><code class="language-toml">[dependencies]
obsidian = { path = &quot;..&quot; }
</code></pre>
<p>Now, run <code>cargo run --release</code> to compile and statically link the program. You should see:</p>
<pre><code class="language-bash">&quot;Hello, world!&quot;
</code></pre>
<h1><a class="header" href="#creating-the-application" id="creating-the-application">Creating the Application</a></h1>
<p>To make our application boilerplate reusable, we created the <code>obsidian_app</code> library. Now, we can start filling it out!</p>
<h2><a class="header" href="#configuring-the-application" id="configuring-the-application">Configuring the Application</a></h2>
<p>Add an application configuration struct:</p>
<pre><code class="language-rust noplaypen">pub struct AppConfig {
    pub width: u32,
    pub height: u32,
    pub title: String,
}

impl Default for AppConfig {
    fn default() -&gt; Self {
        Self {
            width: 800,
            height: 600,
            title: &quot;Obsidian Application&quot;.to_string(),
        }
    }
}
</code></pre>
<h2><a class="header" href="#dependencies-1" id="dependencies-1">Dependencies</a></h2>
<p>We will need to pull in crates for <a href="https://github.com/rust-windowing/winit">windowing</a>, <a href="https://github.com/dtolnay/anyhow">error handling</a>, and the <a href="https://github.com/rust-lang/log">rust logger facade</a>.</p>
<p>Add the following to <code>crates/obsidian_app/Cargo.toml</code>:</p>
<pre><code class="language-toml">anyhow = &quot;1.0.34&quot;
log = &quot;0.4.11&quot;
winit = &quot;0.24.0&quot;
</code></pre>
<p>And add the following to <code>viewer/Cargo.toml</code>:</p>
<pre><code class="language-toml">anyhow = &quot;1.0.34&quot;
log = &quot;0.4.11&quot;
</code></pre>
<h2><a class="header" href="#generalizing-the-application" id="generalizing-the-application">Generalizing the Application</a></h2>
<p>The application can be broken down into discrete steps, such as initialization, updating, handling events, and more. This can be described with a trait:</p>
<pre><code class="language-rust noplaypen">pub trait Run {
    fn initialize(&amp;mut self, _application: &amp;mut Application) -&gt; Result&lt;()&gt; {
        Ok(())
    }

    fn update(&amp;mut self, _application: &amp;mut Application) -&gt; Result&lt;()&gt; {
        Ok(())
    }
}
</code></pre>
<p>Now we can create a function to execute any type that implements the trait:</p>
<pre><code class="language-rust noplaypen">pub fn run_application(mut runner: impl Run + 'static, configuration: AppConfig) -&gt; Result&lt;()&gt; {
    // TODO ...
}
</code></pre>
<h2><a class="header" href="#the-event-loop" id="the-event-loop">The Event Loop</a></h2>
<p>Now we can fill out the body of the <code>run_application</code> function.</p>
<p>We can create the window, an instance of the application, and call the <code>initialize</code> function of the runner.</p>
<pre><code class="language-rust noplaypen">    let (event_loop, _window) = create_window(&amp;configuration)?;

    let mut application = Application {};

    log::info!(&quot;Running Application&quot;);
    runner.initialize(&amp;mut application)?;
</code></pre>
<p>The <code>winit</code> crate manages the event loop. For easy error handling, we will use a lambda that returns a <code>Result&lt;()&gt;</code> to handle each cycle. This lets us check for application errors and log them.</p>
<p>Inside of the event loop we can also handle events and invoke the application runner's methods.</p>
<blockquote>
<p>Note: The <a href="https://docs.rs/winit/0.24.0/winit/event_loop/enum.ControlFlow.html">control_flow</a> object allows controlling the main loop's behavior. For a game loop or realtime rendering application we will need to execute the loop continously, so we use <code>ControlFlow::Poll</code>.</p>
</blockquote>
<pre><code class="language-rust noplaypen">    event_loop.run(move |event, _, control_flow| {
        let mut cycle_result = || -&gt; Result&lt;()&gt; {
            *control_flow = ControlFlow::Poll;
            match event {
                Event::MainEventsCleared =&gt; {
                    runner.update(&amp;mut application)?;
                }
                Event::WindowEvent {
                    event: WindowEvent::CloseRequested,
                    ..
                } =&gt; {
                    *control_flow = ControlFlow::Exit;
                }
                Event::LoopDestroyed =&gt; {
                    info!(&quot;Exited application&quot;);
                }
                _ =&gt; {}
            }
            Ok(())
        };
        if let Err(error) = cycle_result() {
            error!(&quot;Application Error: {}&quot;, error);
        }
    });

</code></pre>
<h2><a class="header" href="#source-code" id="source-code">Source Code</a></h2>
<p>The full source for the <code>app</code> module code presented so far look like this:</p>
<pre><code class="language-rust noplaypen">// crates/obsidian_app/src/app.rs
use anyhow::Result;
use log::{error, info};
use winit::{
    dpi::PhysicalSize,
    event::{Event, WindowEvent},
    event_loop::{ControlFlow, EventLoop},
    window::{Window, WindowBuilder},
};

pub struct AppConfig {
    pub width: u32,
    pub height: u32,
    pub title: String,
    pub logfile_name: String,
}

pub fn create_window(config: &amp;AppConfig) -&gt; Result&lt;(EventLoop&lt;()&gt;, Window)&gt; {
    let event_loop = EventLoop::new();

    let window = WindowBuilder::new()
        .with_title(config.title.to_string())
        .with_inner_size(PhysicalSize::new(config.width, config.height))
        .build(&amp;event_loop)?;

    Ok((event_loop, window))
}

impl Default for AppConfig {
    fn default() -&gt; Self {
        Self {
            width: 800,
            height: 600,
            title: &quot;Obsidian Application&quot;.to_string(),
            logfile_name: &quot;obsidian.log&quot;.to_string(),
        }
    }
}

pub struct Application;

pub trait Run {
    fn initialize(&amp;mut self, _application: &amp;mut Application) -&gt; Result&lt;()&gt; {
        Ok(())
    }

    fn update(&amp;mut self, _application: &amp;mut Application) -&gt; Result&lt;()&gt; {
        Ok(())
    }
}

pub fn run_application(mut runner: impl Run + 'static, configuration: AppConfig) -&gt; Result&lt;()&gt; {
    let (event_loop, _window) = create_window(&amp;configuration)?;

    let mut application = Application {};

    log::info!(&quot;Running Application&quot;);
    runner.initialize(&amp;mut application)?;

    event_loop.run(move |event, _, control_flow| {
        let mut cycle_result = || -&gt; Result&lt;()&gt; {
            *control_flow = ControlFlow::Poll;
            match event {
                Event::MainEventsCleared =&gt; {
                    runner.update(&amp;mut application)?;
                }
                Event::WindowEvent {
                    event: WindowEvent::CloseRequested,
                    ..
                } =&gt; {
                    *control_flow = ControlFlow::Exit;
                }
                Event::LoopDestroyed =&gt; {
                    info!(&quot;Exited application&quot;);
                }
                _ =&gt; {}
            }
            Ok(())
        };
        if let Err(error) = cycle_result() {
            error!(&quot;Application Error: {}&quot;, error);
        }
    });
}
</code></pre>
<h2><a class="header" href="#creating-the-viewer" id="creating-the-viewer">Creating the Viewer</a></h2>
<p>Finally, we can use our boilerplate code to create the <code>Viewer</code>.</p>
<pre><code class="language-rust noplaypen">// obsidian/viewer/src/main.rs
use anyhow::Result;
use log::info;
use obsidian::app::{run_application, AppConfig, Application, Run};

pub struct Viewer;

impl Run for Viewer {
    fn initialize(&amp;mut self, _application: &amp;mut Application) -&gt; Result&lt;()&gt; {
        info!(&quot;Viewer initialized&quot;);
        Ok(())
    }

    fn update(&amp;mut self, _application: &amp;mut Application) -&gt; Result&lt;()&gt; {
        Ok(())
    }
}

fn main() -&gt; Result&lt;()&gt; {
    let viewer = Viewer {};
    run_application(
        viewer,
        AppConfig {
            title: &quot;Obsidian Viewer&quot;.to_string(),
            logfile_name: &quot;viewer.log&quot;.to_string(),
            ..Default::default()
        },
    )
}
</code></pre>
<p>Now, when you run the application with <code>cargo run --release</code> from the project root the application will display an empty window with a custom title!</p>
<h1><a class="header" href="#the-logging-backend" id="the-logging-backend">The Logging Backend</a></h1>
<p>In order for the logger facade functions to work, we will need to add a logging backend. For this project, we'll use <a href="https://github.com/drakulix/simplelog.rs">simplelog</a>.</p>
<p>Add this dependency to <code>crates/obsidian_app/Cargo.toml</code>:</p>
<pre><code class="language-toml">simplelog = { version = &quot;0.9.0&quot;, features = [&quot;termcolor&quot;] }
</code></pre>
<blockquote>
<p>Note: The <code>termcolor</code> feature allows for colored terminal log output.</p>
</blockquote>
<p>Now we can create a logger module to setup the logger backend.</p>
<pre><code class="language-rust noplaypen">// crates/obsidian_app/src/lib.rs
mod logger;
...
</code></pre>
<pre><code class="language-rust noplaypen">// crates/obsidian_app/src/logger.rs
use anyhow::{Context, Result};
use simplelog::{CombinedLogger, Config, LevelFilter, TermLogger, TerminalMode, WriteLogger};
use std::{fs::File, path::Path};

pub fn create_logger(path: impl AsRef&lt;Path&gt;) -&gt; Result&lt;()&gt; {
    let name = path.as_ref().display().to_string();
    let error_message = format!(&quot;Failed to create log file named: {}&quot;, name);
    let file = File::create(path).context(error_message)?;
    CombinedLogger::init(vec![
        TermLogger::new(LevelFilter::Info, Config::default(), TerminalMode::Mixed),
        WriteLogger::new(LevelFilter::max(), Config::default(), file),
    ])?;
    Ok(())
}
</code></pre>
<p>The <a href="https://docs.rs/simplelog/0.9.0/simplelog/struct.CombinedLogger.html">CombinedLogger</a> lets us create a <a href="https://docs.rs/simplelog/0.9.0/simplelog/struct.TermLogger.html">TermLogger</a> and a <a href="https://docs.rs/simplelog/0.9.0/simplelog/struct.WriteLogger.html">WriteLogger</a> at the same time. We will only log messages with the severity <a href="https://docs.rs/simplelog/0.9.0/simplelog/enum.Level.html#variant.Info">Info</a> and above to the terminal, and we will log all messages to the configuration file.</p>
<p>And finally we can invoke the <code>create_logger</code> function in our <code>run_application</code> method:</p>
<pre><code class="language-rust noplaypen">pub fn run_application(mut runner: impl Run + 'static, configuration: AppConfig) -&gt; Result&lt;()&gt; {
    create_logger(&amp;configuration.logfile_name)?;
    ...
}
</code></pre>
<h1><a class="header" href="#clearing-the-screen-with-vulkan" id="clearing-the-screen-with-vulkan">Clearing the Screen with Vulkan</a></h1>
<h1><a class="header" href="#the-vulkan-context" id="the-vulkan-context">The Vulkan Context</a></h1>
<h1><a class="header" href="#vulkan-instances" id="vulkan-instances">Vulkan Instances</a></h1>
<h1><a class="header" href="#vulkan-physical-devices" id="vulkan-physical-devices">Vulkan Physical Devices</a></h1>
<h1><a class="header" href="#vulkan-logical-devices" id="vulkan-logical-devices">Vulkan Logical Devices</a></h1>
<h1><a class="header" href="#the-amd-vulkan-memory-allocator" id="the-amd-vulkan-memory-allocator">The AMD Vulkan Memory Allocator</a></h1>
<h1><a class="header" href="#appendix" id="appendix">Appendix</a></h1>
<h1><a class="header" href="#a---further-reading" id="a---further-reading">A - Further Reading</a></h1>
<ul>
<li>
<p><a href="https://vulkan-tutorial.com/">The Vulkan Tutorial by Alexander Overvoorde</a></p>
<p>This is where most people learn Vulkan. It goes over all the fundamentals of Vulkan and focuses on explaining the API and using it to make a graphics application.</p>
</li>
<li>
<p><a href="https://github.com/adrien-ben/vulkan-tutorial-rs">A Rust Version of the Vulkan Tutorial</a></p>
<p>This is an excellent Rust port of the C++ Vulkan Tutorial.</p>
</li>
<li>
<p><a href="https://github.com/SaschaWillems/Vulkan">Sascha Willems Vulkan Tutorials</a></p>
<p>Sascha Willems has a github repo full of a variety of examples of how to use the Vulkan API to achieve various graphics programming techniques. This is highly recommended for anyone using the Vulkan API.</p>
</li>
<li>
<p><a href="https://learnopengl.com/">Learn OpenGL</a></p>
<p>This is a website about graphics programming that focuses on OpenGL programming, but the techniques are all applicable to Vulkan.</p>
</li>
</ul>
<h1><a class="header" href="#b---keywords" id="b---keywords">B - Keywords</a></h1>
<h1><a class="header" href="#c---vulkan-configurator" id="c---vulkan-configurator">C - Vulkan Configurator</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        
        <!-- Google Analytics Tag -->
        <script type="text/javascript">
            var localAddrs = ["localhost", "127.0.0.1", ""];

            // make sure we don't activate google analytics if the developer is
            // inspecting the book locally...
            if (localAddrs.indexOf(document.location.hostname) === -1) {
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-77444816-1', 'auto');
                ga('send', 'pageview');
            }
        </script>
        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
        
        

    </body>
</html>
